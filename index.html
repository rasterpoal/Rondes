<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Rad van rondes - 3 Keuzes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 30px;
    }
    canvas {
      border: 5px solid #333;
      border-radius: 50%;
      margin-top: 20px;
    }
    button {
      padding: 12px 25px;
      font-size: 18px;
      margin: 10px;
      cursor: pointer;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 10px;
    }
    button:hover {
      background: #45a049;
    }
    #resultaat {
      margin-top: 30px;
      font-size: 24px;
      font-weight: bold;
      min-height: 30px;
    }
    .confetti {
      position: fixed;
      width: 8px;
      height: 8px;
      top: -10px;
      animation: vallen linear forwards;
    }
    @keyframes vallen {
      to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <h1>Rad van rondes</h1>
  <canvas id="wheel" width="400" height="400"></canvas><br>
  <button onclick="startSpel()">Start spel (3 keuzes)</button>
  <button onclick="resetSpel()">Reset</button>
  <div id="resultaat"></div>

  <script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const opties = ["Receptie", "Techniek", "Centrum"];
    const kleuren = ["#FF9999", "#99CCFF", "#99FF99"];

    let startAngle = 0;
    let draaiende = false;
    let resterendeOpties = [...opties];
    let ronde = 0;

    // Geluid (tick)
    const tickGeluid = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");

    function tekenRad() {
      const arc = Math.PI * 2 / opties.length;
      for (let i = 0; i < opties.length; i++) {
        const angle = startAngle + i * arc;
        ctx.fillStyle = kleuren[i];
        ctx.beginPath();
        ctx.moveTo(200, 200);
        ctx.arc(200, 200, 200, angle, angle + arc);
        ctx.fill();
        ctx.save();
        ctx.translate(200, 200);
        ctx.rotate(angle + arc / 2);
        ctx.fillStyle = "black";
        ctx.font = "20px Arial";
        ctx.textAlign = "right";
        ctx.fillText(opties[i], 180, 10);
        ctx.restore();
      }
      // pijltje
      ctx.fillStyle = "#000";
      ctx.beginPath();
      ctx.moveTo(200, 0);
      ctx.lineTo(190, 20);
      ctx.lineTo(210, 20);
      ctx.closePath();
      ctx.fill();
    }

    function startSpel() {
      ronde = 0;
      resterendeOpties = [...opties]; // reset
      document.getElementById("resultaat").innerText = "";
      draaiVolgende();
    }

    function resetSpel() {
      ronde = 0;
      resterendeOpties = [...opties];
      document.getElementById("resultaat").innerText = "";
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      startAngle = 0;
      tekenRad();
    }

    function draaiVolgende() {
      if (ronde >= 3) return;
      draaiRad(() => {
        ronde++;
        setTimeout(() => {
          draaiVolgende();
        }, 1500);
      });
    }

    function draaiRad(callback) {
      if (draaiende) return;
      draaiende = true;

      const draaiTijd = 4000;
      const draaiHoek = Math.random() * Math.PI * 4 + Math.PI * 6;
      const start = performance.now();
      let laatsteTick = 0;

      function animatie(tijd) {
        const progress = Math.min((tijd - start) / draaiTijd, 1);
        startAngle = progress * draaiHoek;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        tekenRad();

        // speel tick-geluid
        const ticks = Math.floor(progress * 30);
        if (ticks > laatsteTick) {
          tickGeluid.currentTime = 0;
          tickGeluid.play();
          laatsteTick = ticks;
        }

        if (progress < 1) {
          requestAnimationFrame(animatie);
        } else {
          draaiende = false;
          const uitkomst = bepaalUitkomst();
          toonUitkomst(uitkomst);
          maakConfetti();
          if (callback) callback();
        }
      }
      requestAnimationFrame(animatie);
    }

    function bepaalUitkomst() {
      const arc = Math.PI * 2 / opties.length;
      const hoek = (2 * Math.PI - (startAngle % (2 * Math.PI))) % (2 * Math.PI);
      let index = Math.floor(hoek / arc);
      // zorg dat alleen nog niet gekozen opties gekozen worden
      while (!resterendeOpties.includes(opties[index])) {
        index = (index + 1) % opties.length;
      }
      const gekozen = opties[index];
      resterendeOpties = resterendeOpties.filter(o => o !== gekozen);
      return gekozen;
    }

    function toonUitkomst(uitkomst) {
      const div = document.getElementById("resultaat");
      div.innerHTML += `<div>Keuze ${ronde + 1}: ${uitkomst}</div>`;
    }

    function maakConfetti() {
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement("div");
        confetti.classList.add("confetti");
        confetti.style.left = Math.random() * 100 + "vw";
        confetti.style.background = ["red","blue","green","yellow","orange","purple"][Math.floor(Math.random()*6)];
        confetti.style.animationDuration = (Math.random() * 2 + 2) + "s";
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 4000);
      }
    }

    tekenRad();
  </script>
</body>
</html>